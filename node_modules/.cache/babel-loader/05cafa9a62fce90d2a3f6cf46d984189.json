{"ast":null,"code":"\"use strict\";\n\nvar _regeneratorRuntime = require(\"C:\\\\development\\\\milkybae\\\\node_modules\\\\@babel\\\\runtime\\\\regenerator\\\\index.js\");\n\nvar _asyncToGenerator = require(\"C:\\\\development\\\\milkybae\\\\node_modules\\\\@babel\\\\runtime\\\\helpers\\\\asyncToGenerator.js\").default;\n\nvar __importDefault = this && this.__importDefault || function (mod) {\n  return mod && mod.__esModule ? mod : {\n    \"default\": mod\n  };\n};\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nvar react_1 = require(\"react\");\n\nvar logger_1 = __importDefault(require(\"../logger\"));\n\nvar useWalletHooks_1 = __importDefault(require(\"./useWalletHooks\"));\n\nvar useGatekeeper = function useGatekeeper(_ref, state, dispatch) {\n  var wallet = _ref.wallet,\n      stage = _ref.stage,\n      gatekeeperClient = _ref.gatekeeperClient;\n\n  var _ref2 = (0, useWalletHooks_1.default)(wallet, state, dispatch),\n      expectWalletConnected = _ref2.expectWalletConnected;\n\n  var gatekeeperNetworkAddress = state.gatekeeperNetworkAddress;\n  /**\n   * if a request is not already in progress, initiate a request to the gatekeeper for a new token\n   * and dispatch an event so we know it's in progress\n   */\n\n  var waitForGatekeeperIssuanceRequest = (0, react_1.useCallback)(\n  /*#__PURE__*/\n  // eslint-disable-next-line @typescript-eslint/no-shadow\n  function () {\n    var _ref4 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee(_ref3) {\n      var payload, proof, connectedWallet, requestGatewayTokenFromGatekeeperResult;\n      return _regeneratorRuntime.wrap(function _callee$(_context) {\n        while (1) {\n          switch (_context.prev = _context.next) {\n            case 0:\n              payload = _ref3.payload, proof = _ref3.proof;\n              connectedWallet = expectWalletConnected();\n\n              if (!connectedWallet) {\n                _context.next = 15;\n                break;\n              }\n\n              logger_1.default.debug('waitForGatekeeperIssuanceRequest ready to call requestGatewayTokenFromGatekeeper', {\n                payload: payload\n              });\n              dispatch({\n                type: 'requestGatekeeperIssuance'\n              });\n              _context.next = 7;\n              return gatekeeperClient().requestGatewayTokenFromGatekeeper({\n                wallet: connectedWallet,\n                payload: payload,\n                proof: proof\n              });\n\n            case 7:\n              requestGatewayTokenFromGatekeeperResult = _context.sent;\n              logger_1.default.debug('requestGatewayTokenFromGatekeeperResult', requestGatewayTokenFromGatekeeperResult);\n\n              if (!(requestGatewayTokenFromGatekeeperResult.status >= 400)) {\n                _context.next = 13;\n                break;\n              }\n\n              logger_1.default.error('Error requesting token from gatekeeper');\n              dispatch({\n                type: 'requestGatekeeperIssuanceFailed'\n              });\n              throw new Error('Error requesting token from gatekeeper');\n\n            case 13:\n              logger_1.default.debug('Successfully created gatekeeper token');\n              dispatch({\n                type: 'requestGatekeeperIssuanceComplete'\n              });\n\n            case 15:\n            case \"end\":\n              return _context.stop();\n          }\n        }\n      }, _callee);\n    }));\n\n    return function (_x) {\n      return _ref4.apply(this, arguments);\n    };\n  }(), [gatekeeperClient, expectWalletConnected, stage]);\n  /**\n   * Update the state when the Gatekeeper network changes\n   */\n\n  (0, react_1.useEffect)(function () {\n    if (wallet && wallet.publicKey && gatekeeperNetworkAddress) {\n      dispatch({\n        type: 'gatekeeperNetworkChanged',\n        gatekeeperNetworkAddress: gatekeeperNetworkAddress\n      });\n    }\n  }, [gatekeeperNetworkAddress]);\n  return {\n    waitForGatekeeperIssuanceRequest: waitForGatekeeperIssuanceRequest,\n    gatekeeperClient: gatekeeperClient\n  };\n};\n\nexports.default = useGatekeeper;","map":{"version":3,"sources":["C:/development/milkybae/node_modules/@civic/solana-gateway-react/dist/esm/useHooks/useGatekeeper.js"],"names":["__importDefault","mod","__esModule","Object","defineProperty","exports","value","react_1","require","logger_1","useWalletHooks_1","useGatekeeper","state","dispatch","wallet","stage","gatekeeperClient","default","expectWalletConnected","gatekeeperNetworkAddress","waitForGatekeeperIssuanceRequest","useCallback","payload","proof","connectedWallet","debug","type","requestGatewayTokenFromGatekeeper","requestGatewayTokenFromGatekeeperResult","status","error","Error","useEffect","publicKey"],"mappings":"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","sourcesContent":["\"use strict\";\nvar __importDefault = (this && this.__importDefault) || function (mod) {\n    return (mod && mod.__esModule) ? mod : { \"default\": mod };\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nconst react_1 = require(\"react\");\nconst logger_1 = __importDefault(require(\"../logger\"));\nconst useWalletHooks_1 = __importDefault(require(\"./useWalletHooks\"));\nconst useGatekeeper = ({ wallet, stage, gatekeeperClient, }, state, dispatch) => {\n    const { expectWalletConnected } = (0, useWalletHooks_1.default)(wallet, state, dispatch);\n    const { gatekeeperNetworkAddress } = state;\n    /**\n     * if a request is not already in progress, initiate a request to the gatekeeper for a new token\n     * and dispatch an event so we know it's in progress\n     */\n    const waitForGatekeeperIssuanceRequest = (0, react_1.useCallback)(\n    // eslint-disable-next-line @typescript-eslint/no-shadow\n    async ({ payload, proof }) => {\n        const connectedWallet = expectWalletConnected();\n        if (connectedWallet) {\n            logger_1.default.debug('waitForGatekeeperIssuanceRequest ready to call requestGatewayTokenFromGatekeeper', {\n                payload,\n            });\n            dispatch({ type: 'requestGatekeeperIssuance' });\n            const requestGatewayTokenFromGatekeeperResult = await gatekeeperClient().requestGatewayTokenFromGatekeeper({\n                wallet: connectedWallet,\n                payload,\n                proof,\n            });\n            logger_1.default.debug('requestGatewayTokenFromGatekeeperResult', requestGatewayTokenFromGatekeeperResult);\n            if (requestGatewayTokenFromGatekeeperResult.status >= 400) {\n                logger_1.default.error('Error requesting token from gatekeeper');\n                dispatch({ type: 'requestGatekeeperIssuanceFailed' });\n                throw new Error('Error requesting token from gatekeeper');\n            }\n            logger_1.default.debug('Successfully created gatekeeper token');\n            dispatch({ type: 'requestGatekeeperIssuanceComplete' });\n        }\n    }, [gatekeeperClient, expectWalletConnected, stage]);\n    /**\n     * Update the state when the Gatekeeper network changes\n     */\n    (0, react_1.useEffect)(() => {\n        if (wallet && wallet.publicKey && gatekeeperNetworkAddress) {\n            dispatch({ type: 'gatekeeperNetworkChanged', gatekeeperNetworkAddress });\n        }\n    }, [gatekeeperNetworkAddress]);\n    return {\n        waitForGatekeeperIssuanceRequest,\n        gatekeeperClient,\n    };\n};\nexports.default = useGatekeeper;\n"]},"metadata":{},"sourceType":"script"}