{"ast":null,"code":"\"use strict\";\n\nvar _slicedToArray = require(\"C:\\\\development\\\\milkybae\\\\node_modules\\\\@babel\\\\runtime\\\\helpers\\\\slicedToArray.js\").default;\n\nvar _regeneratorRuntime = require(\"C:\\\\development\\\\milkybae\\\\node_modules\\\\@babel\\\\runtime\\\\regenerator\\\\index.js\");\n\nvar _asyncToGenerator = require(\"C:\\\\development\\\\milkybae\\\\node_modules\\\\@babel\\\\runtime\\\\helpers\\\\asyncToGenerator.js\").default;\n\nvar __createBinding = this && this.__createBinding || (Object.create ? function (o, m, k, k2) {\n  if (k2 === undefined) k2 = k;\n  Object.defineProperty(o, k2, {\n    enumerable: true,\n    get: function get() {\n      return m[k];\n    }\n  });\n} : function (o, m, k, k2) {\n  if (k2 === undefined) k2 = k;\n  o[k2] = m[k];\n});\n\nvar __setModuleDefault = this && this.__setModuleDefault || (Object.create ? function (o, v) {\n  Object.defineProperty(o, \"default\", {\n    enumerable: true,\n    value: v\n  });\n} : function (o, v) {\n  o[\"default\"] = v;\n});\n\nvar __importStar = this && this.__importStar || function (mod) {\n  if (mod && mod.__esModule) return mod;\n  var result = {};\n  if (mod != null) for (var k in mod) {\n    if (k !== \"default\" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);\n  }\n\n  __setModuleDefault(result, mod);\n\n  return result;\n};\n\nvar __importDefault = this && this.__importDefault || function (mod) {\n  return mod && mod.__esModule ? mod : {\n    \"default\": mod\n  };\n};\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.useGateway = exports.GatewayProvider = void 0;\n\nvar react_1 = __importStar(require(\"react\"));\n\nvar iframe_resizer_react_1 = __importDefault(require(\"iframe-resizer-react\"));\n\nvar types_1 = require(\"../types\");\n\nvar logger_1 = __importDefault(require(\"../logger\"));\n\nvar Wrapper_1 = require(\"../wrapper/Wrapper\");\n\nvar constants_1 = require(\"../constants\");\n\nvar config_1 = require(\"../config\");\n\nvar config_2 = require(\"../solana/config\");\n\nvar gatekeeperClient_1 = __importDefault(require(\"../utils/gatekeeperClient\"));\n\nvar useReducer_1 = __importDefault(require(\"../useReducer\"));\n\nvar useUserInteraction_1 = __importDefault(require(\"../useHooks/useUserInteraction\"));\n\nvar useOrchestration_1 = __importDefault(require(\"../useHooks/useOrchestration\"));\n\nvar useCivicPass_1 = __importDefault(require(\"../useHooks/useCivicPass\"));\n\nvar useWalletHooks_1 = __importDefault(require(\"../useHooks/useWalletHooks\"));\n\nvar useCivicPassEventListener_1 = __importDefault(require(\"../useHooks/useCivicPassEventListener\"));\n\nvar GatewayContext = react_1.default.createContext({\n  requestGatewayToken: function () {\n    var _requestGatewayToken = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee() {\n      return _regeneratorRuntime.wrap(function _callee$(_context) {\n        while (1) {\n          switch (_context.prev = _context.next) {\n            case 0:\n            case \"end\":\n              return _context.stop();\n          }\n        }\n      }, _callee);\n    }));\n\n    function requestGatewayToken() {\n      return _requestGatewayToken.apply(this, arguments);\n    }\n\n    return requestGatewayToken;\n  }(),\n  gatewayStatus: types_1.GatewayStatus.NOT_REQUESTED,\n  stage: config_1.DEFAULT_GATEKEEPER_STAGE\n});\n\nvar redirectUrlFromWindow = function redirectUrlFromWindow() {\n  return encodeURIComponent(window.location.href.split('?')[0]);\n};\n\nvar GatewayProvider = function GatewayProvider(_ref) {\n  var _ref$children = _ref.children,\n      children = _ref$children === void 0 ? null : _ref$children,\n      wallet = _ref.wallet,\n      chainImplementation = _ref.chainImplementation,\n      wrapper = _ref.wrapper,\n      logo = _ref.logo,\n      _ref$stage = _ref.stage,\n      stage = _ref$stage === void 0 ? 'prod' : _ref$stage,\n      redirectUrl = _ref.redirectUrl,\n      gatekeeperNetwork = _ref.gatekeeperNetwork,\n      _ref$options = _ref.options,\n      options = _ref$options === void 0 ? {\n    autoShowModal: true\n  } : _ref$options;\n  var gatekeeperNetworkAddress = gatekeeperNetwork;\n\n  var _ref2 = (0, react_1.useReducer)(useReducer_1.default, {\n    options: options,\n    gatewayStatus: types_1.GatewayStatus.UNKNOWN,\n    tokenRequested: false,\n    iframeMinimized: false,\n    firstTokenCheck: true,\n    renderIframe: false,\n    powoFinished: false,\n    refreshInProgress: false,\n    walletPowoInProgress: false,\n    walletAddress: wallet === null || wallet === void 0 ? void 0 : wallet.publicKey,\n    iframeSrcUrl: undefined,\n    stage: stage,\n    redirectUrl: redirectUrl || redirectUrlFromWindow(),\n    tokenIssuanceState: types_1.TokenIssuanceState.NOT_REQUESTED,\n    refreshTokenState: types_1.RefreshTokenState.NOT_REQUIRED,\n    civicPass: {\n      status: types_1.CivicPassIssuanceStatus.NOT_REQUESTED,\n      iframeMinimized: false,\n      renderIframe: false\n    },\n    gatekeeperNetworkAddress: gatekeeperNetworkAddress,\n    chainType: chainImplementation.chainType\n  }),\n      _ref3 = _slicedToArray(_ref2, 2),\n      state = _ref3[0],\n      dispatch = _ref3[1];\n\n  var gatewayStatus = state.gatewayStatus,\n      iframeMinimized = state.iframeMinimized,\n      renderIframe = state.renderIframe,\n      gatewayToken = state.gatewayToken,\n      iframeSrcUrl = state.iframeSrcUrl;\n  (0, useWalletHooks_1.default)(wallet, state, dispatch); // need to handle wallet connect and disconnect first\n  // ensure the state is updated with any changes to input props\n\n  (0, react_1.useEffect)(function () {\n    dispatch({\n      type: 'updateStateWithProps',\n      redirectUrl: redirectUrl || redirectUrlFromWindow(),\n      stage: stage,\n      walletAddress: wallet === null || wallet === void 0 ? void 0 : wallet.publicKey,\n      gatekeeperNetworkAddress: gatekeeperNetworkAddress\n    });\n  }, [redirectUrl, stage, wallet, gatekeeperNetworkAddress]);\n  var clusterName = chainImplementation.httpConfig.queryParams.network;\n  var gatekeeperEndpoint = (0, config_2.getGatekeeperEndpoint)(stage);\n  var gatekeeperClient = (0, react_1.useCallback)(function () {\n    if (!gatekeeperNetworkAddress) {\n      throw new Error('No gatekeeper network passed in.');\n    }\n\n    return new gatekeeperClient_1.default({\n      baseUrl: gatekeeperEndpoint,\n      stage: stage,\n      queryParams: {\n        network: clusterName,\n        gatekeeperNetworkAddress: gatekeeperNetworkAddress\n      }\n    });\n  }, [stage, gatekeeperEndpoint, gatekeeperNetworkAddress, clusterName]); // listen and act on events from the compliance iframe\n\n  (0, useCivicPass_1.default)({\n    wallet: wallet\n  }, state, dispatch);\n  (0, useCivicPassEventListener_1.default)({\n    wallet: wallet,\n    chainImplementation: chainImplementation\n  }); // this hook implements the main business logic and handles requesting and refreshing gateway tokens\n\n  (0, useOrchestration_1.default)({\n    wallet: wallet,\n    chainImplementation: chainImplementation,\n    stage: stage,\n    gatekeeperClient: gatekeeperClient\n  }, state, dispatch); // requestGatewayToken is the only user-triggered event handled by the component\n  // the compliance iframe user interaction is handled using events triggered from the iframe\n\n  var _ref4 = (0, useUserInteraction_1.default)({\n    wallet: wallet\n  }, state, dispatch),\n      requestGatewayToken = _ref4.requestGatewayToken;\n\n  var civicPassSrcUrl = (0, config_1.getCivicPassEndpoint)(stage);\n  /**\n   * manage local state for display of the close button ui relative to iframe loading\n   */\n\n  var _ref5 = (0, react_1.useState)(false),\n      _ref6 = _slicedToArray(_ref5, 2),\n      iframeLoaded = _ref6[0],\n      setIframeLoaded = _ref6[1];\n\n  (0, react_1.useEffect)(function () {\n    logger_1.default.info('GatewayContext gatewayStatus', types_1.GatewayStatus[gatewayStatus]);\n  }, [gatewayStatus]);\n  /**\n   * Reset the iFrame when removing the iFrame from the DOM\n   */\n\n  (0, react_1.useEffect)(function () {\n    if (!renderIframe) {\n      setIframeLoaded(false);\n    }\n  }, [renderIframe]);\n  return react_1.default.createElement(GatewayContext.Provider, {\n    value: {\n      requestGatewayToken: requestGatewayToken,\n      gatewayStatus: gatewayStatus,\n      gatewayToken: gatewayStatus === types_1.GatewayStatus.ACTIVE ? gatewayToken : undefined,\n      stage: stage,\n      civicPassSrcUrl: civicPassSrcUrl\n    }\n  }, children, renderIframe && react_1.default.createElement(\"div\", {\n    \"data-testid\": constants_1.TESTID_WRAPPER_CONTAINER,\n    hidden: iframeMinimized\n  }, react_1.default.createElement(Wrapper_1.Wrapper, {\n    \"data-testid\": constants_1.TESTID_WRAPPER,\n    onClose: function onClose() {\n      return dispatch({\n        type: 'civicPass_close'\n      });\n    },\n    wrapper: wrapper,\n    logo: logo,\n    loaded: iframeLoaded\n  }, react_1.default.createElement(iframe_resizer_react_1.default, {\n    \"data-testid\": constants_1.TESTID_IFRAME,\n    src: iframeSrcUrl,\n    id: constants_1.IFRAME_ID,\n    style: {\n      width: '1px',\n      minWidth: '100%',\n      border: 'none',\n      height: '26px',\n      transition: 'height 0.25s ease'\n    },\n    heightCalculationMethod: \"min\",\n    checkOrigin: false,\n    onLoad: function onLoad() {\n      return setIframeLoaded(true);\n    },\n    inPageLinks: true,\n    allow: \"camera\",\n    allowFullScreen: true,\n    frameBorder: \"0\"\n  }))));\n};\n\nexports.GatewayProvider = GatewayProvider;\n\nvar useGateway = function useGateway() {\n  return (0, react_1.useContext)(GatewayContext);\n};\n\nexports.useGateway = useGateway;","map":{"version":3,"sources":["C:/development/milkybae/node_modules/@civic/solana-gateway-react/dist/esm/gateway/GatewayContext.js"],"names":["__createBinding","Object","create","o","m","k","k2","undefined","defineProperty","enumerable","get","__setModuleDefault","v","value","__importStar","mod","__esModule","result","prototype","hasOwnProperty","call","__importDefault","exports","useGateway","GatewayProvider","react_1","require","iframe_resizer_react_1","types_1","logger_1","Wrapper_1","constants_1","config_1","config_2","gatekeeperClient_1","useReducer_1","useUserInteraction_1","useOrchestration_1","useCivicPass_1","useWalletHooks_1","useCivicPassEventListener_1","GatewayContext","default","createContext","requestGatewayToken","gatewayStatus","GatewayStatus","NOT_REQUESTED","stage","DEFAULT_GATEKEEPER_STAGE","redirectUrlFromWindow","encodeURIComponent","window","location","href","split","children","wallet","chainImplementation","wrapper","logo","redirectUrl","gatekeeperNetwork","options","autoShowModal","gatekeeperNetworkAddress","useReducer","UNKNOWN","tokenRequested","iframeMinimized","firstTokenCheck","renderIframe","powoFinished","refreshInProgress","walletPowoInProgress","walletAddress","publicKey","iframeSrcUrl","tokenIssuanceState","TokenIssuanceState","refreshTokenState","RefreshTokenState","NOT_REQUIRED","civicPass","status","CivicPassIssuanceStatus","chainType","state","dispatch","gatewayToken","useEffect","type","clusterName","httpConfig","queryParams","network","gatekeeperEndpoint","getGatekeeperEndpoint","gatekeeperClient","useCallback","Error","baseUrl","civicPassSrcUrl","getCivicPassEndpoint","useState","iframeLoaded","setIframeLoaded","info","createElement","Provider","ACTIVE","TESTID_WRAPPER_CONTAINER","hidden","Wrapper","TESTID_WRAPPER","onClose","loaded","TESTID_IFRAME","src","id","IFRAME_ID","style","width","minWidth","border","height","transition","heightCalculationMethod","checkOrigin","onLoad","inPageLinks","allow","allowFullScreen","frameBorder","useContext"],"mappings":"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","sourcesContent":["\"use strict\";\nvar __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {\n    if (k2 === undefined) k2 = k;\n    Object.defineProperty(o, k2, { enumerable: true, get: function() { return m[k]; } });\n}) : (function(o, m, k, k2) {\n    if (k2 === undefined) k2 = k;\n    o[k2] = m[k];\n}));\nvar __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {\n    Object.defineProperty(o, \"default\", { enumerable: true, value: v });\n}) : function(o, v) {\n    o[\"default\"] = v;\n});\nvar __importStar = (this && this.__importStar) || function (mod) {\n    if (mod && mod.__esModule) return mod;\n    var result = {};\n    if (mod != null) for (var k in mod) if (k !== \"default\" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);\n    __setModuleDefault(result, mod);\n    return result;\n};\nvar __importDefault = (this && this.__importDefault) || function (mod) {\n    return (mod && mod.__esModule) ? mod : { \"default\": mod };\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.useGateway = exports.GatewayProvider = void 0;\nconst react_1 = __importStar(require(\"react\"));\nconst iframe_resizer_react_1 = __importDefault(require(\"iframe-resizer-react\"));\nconst types_1 = require(\"../types\");\nconst logger_1 = __importDefault(require(\"../logger\"));\nconst Wrapper_1 = require(\"../wrapper/Wrapper\");\nconst constants_1 = require(\"../constants\");\nconst config_1 = require(\"../config\");\nconst config_2 = require(\"../solana/config\");\nconst gatekeeperClient_1 = __importDefault(require(\"../utils/gatekeeperClient\"));\nconst useReducer_1 = __importDefault(require(\"../useReducer\"));\nconst useUserInteraction_1 = __importDefault(require(\"../useHooks/useUserInteraction\"));\nconst useOrchestration_1 = __importDefault(require(\"../useHooks/useOrchestration\"));\nconst useCivicPass_1 = __importDefault(require(\"../useHooks/useCivicPass\"));\nconst useWalletHooks_1 = __importDefault(require(\"../useHooks/useWalletHooks\"));\nconst useCivicPassEventListener_1 = __importDefault(require(\"../useHooks/useCivicPassEventListener\"));\nconst GatewayContext = react_1.default.createContext({\n    requestGatewayToken: async () => { },\n    gatewayStatus: types_1.GatewayStatus.NOT_REQUESTED,\n    stage: config_1.DEFAULT_GATEKEEPER_STAGE,\n});\nconst redirectUrlFromWindow = () => encodeURIComponent(window.location.href.split('?')[0]);\nconst GatewayProvider = ({ children = null, wallet, chainImplementation, wrapper, logo, stage = 'prod', redirectUrl, gatekeeperNetwork, options = { autoShowModal: true }, }) => {\n    const gatekeeperNetworkAddress = gatekeeperNetwork;\n    const [state, dispatch] = (0, react_1.useReducer)(useReducer_1.default, {\n        options,\n        gatewayStatus: types_1.GatewayStatus.UNKNOWN,\n        tokenRequested: false,\n        iframeMinimized: false,\n        firstTokenCheck: true,\n        renderIframe: false,\n        powoFinished: false,\n        refreshInProgress: false,\n        walletPowoInProgress: false,\n        walletAddress: wallet === null || wallet === void 0 ? void 0 : wallet.publicKey,\n        iframeSrcUrl: undefined,\n        stage,\n        redirectUrl: redirectUrl || redirectUrlFromWindow(),\n        tokenIssuanceState: types_1.TokenIssuanceState.NOT_REQUESTED,\n        refreshTokenState: types_1.RefreshTokenState.NOT_REQUIRED,\n        civicPass: {\n            status: types_1.CivicPassIssuanceStatus.NOT_REQUESTED,\n            iframeMinimized: false,\n            renderIframe: false,\n        },\n        gatekeeperNetworkAddress,\n        chainType: chainImplementation.chainType,\n    });\n    const { gatewayStatus, iframeMinimized, renderIframe, gatewayToken, iframeSrcUrl } = state;\n    (0, useWalletHooks_1.default)(wallet, state, dispatch); // need to handle wallet connect and disconnect first\n    // ensure the state is updated with any changes to input props\n    (0, react_1.useEffect)(() => {\n        dispatch({\n            type: 'updateStateWithProps',\n            redirectUrl: redirectUrl || redirectUrlFromWindow(),\n            stage,\n            walletAddress: wallet === null || wallet === void 0 ? void 0 : wallet.publicKey,\n            gatekeeperNetworkAddress,\n        });\n    }, [redirectUrl, stage, wallet, gatekeeperNetworkAddress]);\n    const clusterName = chainImplementation.httpConfig.queryParams.network;\n    const gatekeeperEndpoint = (0, config_2.getGatekeeperEndpoint)(stage);\n    const gatekeeperClient = (0, react_1.useCallback)(() => {\n        if (!gatekeeperNetworkAddress) {\n            throw new Error('No gatekeeper network passed in.');\n        }\n        return new gatekeeperClient_1.default({\n            baseUrl: gatekeeperEndpoint,\n            stage,\n            queryParams: { network: clusterName, gatekeeperNetworkAddress },\n        });\n    }, [stage, gatekeeperEndpoint, gatekeeperNetworkAddress, clusterName]);\n    // listen and act on events from the compliance iframe\n    (0, useCivicPass_1.default)({ wallet }, state, dispatch);\n    (0, useCivicPassEventListener_1.default)({ wallet, chainImplementation });\n    // this hook implements the main business logic and handles requesting and refreshing gateway tokens\n    (0, useOrchestration_1.default)({ wallet, chainImplementation, stage, gatekeeperClient }, state, dispatch);\n    // requestGatewayToken is the only user-triggered event handled by the component\n    // the compliance iframe user interaction is handled using events triggered from the iframe\n    const { requestGatewayToken } = (0, useUserInteraction_1.default)({ wallet }, state, dispatch);\n    const civicPassSrcUrl = (0, config_1.getCivicPassEndpoint)(stage);\n    /**\n     * manage local state for display of the close button ui relative to iframe loading\n     */\n    const [iframeLoaded, setIframeLoaded] = (0, react_1.useState)(false);\n    (0, react_1.useEffect)(() => {\n        logger_1.default.info('GatewayContext gatewayStatus', types_1.GatewayStatus[gatewayStatus]);\n    }, [gatewayStatus]);\n    /**\n     * Reset the iFrame when removing the iFrame from the DOM\n     */\n    (0, react_1.useEffect)(() => {\n        if (!renderIframe) {\n            setIframeLoaded(false);\n        }\n    }, [renderIframe]);\n    return (react_1.default.createElement(GatewayContext.Provider, { value: {\n            requestGatewayToken,\n            gatewayStatus,\n            gatewayToken: gatewayStatus === types_1.GatewayStatus.ACTIVE ? gatewayToken : undefined,\n            stage,\n            civicPassSrcUrl,\n        } },\n        children,\n        renderIframe && (react_1.default.createElement(\"div\", { \"data-testid\": constants_1.TESTID_WRAPPER_CONTAINER, hidden: iframeMinimized },\n            react_1.default.createElement(Wrapper_1.Wrapper, { \"data-testid\": constants_1.TESTID_WRAPPER, onClose: () => dispatch({ type: 'civicPass_close' }), wrapper: wrapper, logo: logo, loaded: iframeLoaded },\n                react_1.default.createElement(iframe_resizer_react_1.default, { \"data-testid\": constants_1.TESTID_IFRAME, src: iframeSrcUrl, id: constants_1.IFRAME_ID, style: {\n                        width: '1px',\n                        minWidth: '100%',\n                        border: 'none',\n                        height: '26px',\n                        transition: 'height 0.25s ease',\n                    }, heightCalculationMethod: \"min\", checkOrigin: false, onLoad: () => setIframeLoaded(true), inPageLinks: true, allow: \"camera\", allowFullScreen: true, frameBorder: \"0\" }))))));\n};\nexports.GatewayProvider = GatewayProvider;\nconst useGateway = () => (0, react_1.useContext)(GatewayContext);\nexports.useGateway = useGateway;\n"]},"metadata":{},"sourceType":"script"}